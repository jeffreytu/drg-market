{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'js/dropzone-5.7.0/min/dropzone.min.css' %}">
</head>
<body>
    {% include "navbar.html" %}
    <div class="container content">
        {% block content %}
        {% endblock content %}
    </div>
    {% include "footer.html" %}
    <script src="https://kit.fontawesome.com/ad2498fa3c.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="{% static 'js/dropzone-5.7.0/dropzone.js' %}"></script>
    <script type="text/javascript">
    Dropzone.autoDiscover = false;
    jQuery(document).ready(function() {
   
            var myyDropzone = new Dropzone("#drop_gallery", {
                    url: window.location.href,
                    params: {'csrfmiddlewaretoken': getCookie('csrftoken')},
                    paramName: "dropzone_gallery",
                    autoProcessQueue: false,
                    addRemoveLinks: true,
                    maxFilesize: 256 * 4 * 2,
                    maxFiles: 5,
                    acceptedFiles: 'image/*',
                    uploadMultiple: true,
                    parallelUploads: 5,

                    init: function() {
                        var myDropzone = this
                        
                        document.getElementById("sell-submit").addEventListener("click", function(e) {
                            // Make sure that the form isn't actually being sent.
                            e.preventDefault();
                            e.stopPropagation();
                            myDropzone.processQueue();
                        });
                        
                        // Listen to the sendingmultiple event. In this case, it's the sendingmultiple event instead
                        // of the sending event because uploadMultiple is set to true.
                        this.on("sendingmultiple", function(data, xhr, formData) {
                            // Gets triggered when the form is actually being sent.
                            // Hide the success button or the complete form.
                            formData.append("title", jQuery("#id_title").val());
                            formData.append("seller", jQuery("#id_seller").val());
                            formData.append("description", jQuery("#id_description").val());
                            formData.append("price", jQuery("#id_price").val());
                            formData.append("category", jQuery("#id_category option:selected").val());
                            formData.append("status", jQuery("#id_status").val());
                            formData.append("product", jQuery("#id_product option:selected").val());

                            /*
                            $(":input[name]", $("form")).each(function () {     formData.append(this.name, $(':input[name=' + this.name + ']', $("form")).val());   });
                            */
                        });
                        this.on("successmultiple", function(files, response) {
                            // Gets triggered when the files have successfully been sent.
                            // Redirect user or notify of success.
                            window.location.href = '/shop/listing/' + response.listing;
                        });
                        this.on("errormultiple", function(files, response) {
                            // Gets triggered when there was an error sending the files.
                            // Maybe show form again, and notify user of error
                        });
                    },
                    //sending: function (file, xhr, formData) {
                        // Along with the file, shall I append all fields from the form above in the formData?
                    //}
            });
    });
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }


    </script>
    <script>
        $('.dropdown-menu a.dropdown-toggle').on('click', function(e) {
        if (!$(this).next().hasClass('show')) {
            $(this).parents('.dropdown-menu').first().find('.show').removeClass('show');
        }
        var $subMenu = $(this).next('.dropdown-menu');
        $subMenu.toggleClass('show');


        $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function(e) {
            $('.dropdown-submenu .show').removeClass('show');
        });


        return false;
        });
        </script>
</body>
</html>