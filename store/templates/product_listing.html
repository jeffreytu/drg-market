{% extends 'base.html' %}
{% load static %}

{% block content %}

        {% if user.id == listing.seller.id and listing.status != 4 %}
            <div class="row">
                <div class="col-md-6">
                    {% if listing.status == 2 %}
                        <span><i class="fas fa-exclamation-circle fa-lg"></i> Listing pending approval</span>
                    {% endif %}
                </div>
                <div class="col-md-6 text-right">
                    <a href="{% url 'edit-listing' listing.id %}">
                        <button class="btn btn-primary btn-sm">Edit</button>
                    </a>
                </div>
            </div>
        {% endif %}

        <h3>{{ listing.category }}</h3>
        <div class="row">
            <div class="col-md-6">
                <div class="listing-detail-container">
                    {% if listing.seller.profile_image %}
                        <div class="profile-image"><img src="{{listing.seller.profile_image.url}}"></div>
                    {% else %}
                        <div class="profile-image"><i class="fa fa-user-circle fa-3x" aria-hidden="true"></i></div>
                    {% endif %}
                    <div class="seller-info">
                        Sold By: <a href="{% url 'view-seller' listing.seller.username %}">{{listing.seller}}</a>
                        {% if listing.location %}<br>{{listing.location}} {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row listing-detail-container">
                    <div class="col-md-6">
                        <div class="listing-price"><span>${{listing.price}}</span></div>
                    </div>
                    <div class="col-md-6">
                        {% if listing.status != 4 %}
                            {% if listing.status == 2 %}
                                <div><button class="btn btn-secondary btn-lg">Unavailable</button></div>
                            {% else %}
                                <div><a href="{% url 'buy-listing' listing.id %}"><button class="btn btn-success btn-lg btn-block">Buy Now</button></a></div>
                            {% endif %}
                        {% else %}
                        <div><button class="btn btn-secondary btn-lg">Sold</button></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>        

        <div class="row container-area">
            <div class="col-md-3 text-center">
                <div class="listing-cat-image">
                    <img src="{{listing.category.image.url}}">
                </div>
            </div>
            <div class="col-md-9">
                {% if gallery %}
                    <div class="listing-images">
                        {% for imagelist in gallery|slice:"5" %}
                            <a href="{{imagelist.image.url}}"><img style="width:100px" src="{{imagelist.image.url}}"></a>
                        {% endfor %}
                    </div>
                {% else %}
                    <span>No images available</span>
                    </p>
                {% endif %}
            </div>
        </div>
        <hr>
        <div class="row container-area no-gutters">
            <div class="col-md-12">
                <h5>Description</h5>
                <strong>{{listing.title}}</strong>
                <div>{{listing.description}}</div>
            </div>
        </div>
    <hr>
    <h5>Comments</h5>
    <div class="row">
        <div class="col-md-6">
            <div class="comment-container">
            {% if comments %}
                {% for comment in comments %}
                    <div class="comment-card">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="seller-info">
                                    {% if listing.seller.profile_image %}
                                        <div class="profile-image"><img src="{{listing.seller.profile_image.url}}"></div>
                                    {% else %}
                                        <div class="profile-image"><i class="fa fa-user-circle fa-3x" aria-hidden="true"></i></div>
                                    {% endif %}
                                    <strong>{{ comment.author }}</strong>
                                    {% if comment.author == listing.seller %}
                                        <div class="badge-seller">Seller</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6 text-right">{{ comment.created_on }}</div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-12">{{ comment.body | linebreaks }}</div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <span>No comments</span>
            {% endif %}
            </div>
        </div>
        <div class="col-md-6">
        </div>
    </div>

    
    {% if listing.status == 1 %}
    <div class="comment-submit-container">
        <div class="row">
            <div class="col-md-6">
                <h5>Submit Comment</h5>
                {% if user.is_authenticated %}
                <form method="post">
                    {% csrf_token %}
                    <div class="comment-body"> 
                        {% comment %} <label>Your comment</label>  {% endcomment %}
                        {{ form.body }} 
                    </div> 
                    <button type="submit" class="btn btn-success">Submit Comment</button>
                </form>
            </div>
            {% else %}
                <p>You must be signed in to comment. Login or Signup</p>
            {% endif %}
            <div class="col-md-6">
                <div class="container-box bg-gray">
                    <p>Comments on this page are public and visible to everyone.</p>
                    <p>After purchasing, you’ll gain access to a private page where you and the seller can communicate and track your item’s shipment.</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

{% endblock content %}