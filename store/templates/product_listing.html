{% extends 'base.html' %}
{% load static %}

{% block content %}

    <h4>{{listing.title}}</h4>
        {% if user.id == listing.seller.id and listing.status != 4 %}
            <div class="row">
                <div class="col-md-12">
                    <a href="{% url 'edit-listing' listing.id %}">Edit</a>
                </div>
            </div>
        {% endif %}

        <div class="row">
            <div class="col-md-6">
                <div class="listing-detail-container">
                    <div>Sold by: {{listing.seller}}</div>
                    <div>{{listing.description}}</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row listing-detail-container">
                    <div class="col-md-6">
                        <div class="listing-price"><span>${{listing.price}}</span></div>
                    </div>
                    <div class="col-md-6">
                        {% if listing.status != 4 %}
                        <div><a href="{% url 'buy-listing' listing.id %}"><button class="btn btn-success btn-lg">Buy Now</button></a></div>
                        {% else %}
                        <div><button class="btn btn-secondary btn-lg">Sold</button></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>        

        <div class="row listing-detail-container">
            <div class="col-md-3 text-center">
                <div class="listing-cat-image">
                    <img src="{{listing.category.image.url}}">
                </div>
            </div>
            <div class="col-md-9">
                {% if gallery %}
                    <div class="listing-images">
                        {% for imagelist in gallery|slice:"5" %}
                            <a href="{{imagelist.image.url}}"><img style="width:100px" src="{{imagelist.image.url}}"></a>
                        {% endfor %}
                    </div>
                {% else %}
                    <span>No images available</span>
                    </p>
                {% endif %}
            </div>
        </div>

    <h5>Comments</h5>
    <div class="row">
        <div class="col-md-8">
            <div class="comment-container">
            {% for comment in comments %}
                <div class="comment-card">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>{{ comment.author }}</strong>
                            {% if comment.author == listing.seller %}
                                <div class="badge-seller">Seller</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 text-right">{{ comment.created_on }}</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-12">{{ comment.body | linebreaks }}</div>
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>

    
    {% if listing.status != 4 %}
    <div class="comment-submit-container">
        <h5>Submit Comment</h5>
        <div class="row">
            <div class="col-md-8">
                {% if user.is_authenticated %}
                <form method="post">
                    {{ form.as_p }}
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success ">Submit Comment</button>
                </form>
            </div>
            {% else %}
                <p>You must be signed in to comment. Login or Signup</p>
            {% endif %}
            <div class="col-md-4">
            </div>
        </div>
    </div>
    {% endif %}

{% endblock content %}